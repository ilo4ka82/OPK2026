"""
–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º.
–†–∞—Å—à–∏—Ä—è–µ—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è, –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—á–∞—Ç–∫–∏.
"""
import re
from typing import Dict


class QueryProcessor:
    """–ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞"""
    
    # –°–ª–æ–≤–∞—Ä—å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π –∏ –∏—Ö —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–æ–∫
    ABBREVIATIONS: Dict[str, str] = {
        # –û—Å–Ω–æ–≤–Ω—ã–µ
        '–±–≤–∏': '–ë–í–ò –±–µ–∑ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π',
        '–∫—Ü–ø': '–ö–¶–ü –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –ø—Ä–∏—ë–º–∞',
        '–µ–≥—ç': '–ï–ì–≠ –µ–¥–∏–Ω—ã–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω',
        '—Ü—Ç': '–¶–¢ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
        
        # –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
        '—Å–ø–æ': '–°–ü–û —Å—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
        '–≤–æ': '–≤—ã—Å—à–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
        '—Å–Ω–∏–ª—Å': '–°–ù–ò–õ–° —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –Ω–æ–º–µ—Ä –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ª–∏—Ü–µ–≤–æ–≥–æ —Å—á—ë—Ç–∞',
        
        # –ö–≤–æ—Ç—ã
        '–æ–∫–≤—ç–¥': '–û–ö–í–≠–î',
        '–æ–ª–∏–º–ø–∏–∞–¥–∞': '–≤—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞',
        
        # –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç
        '–º—Ç—É—Å–∏': '–ú–¢–£–°–ò –ú–æ—Å–∫–æ–≤—Å–∫–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å–≤—è–∑–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏',
        '–º–≥—Ç—É': '–ú–ì–¢–£',
        '–≤—É–∑': '–≤—ã—Å—à–µ–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
    }
    
    # –°–∏–Ω–æ–Ω–∏–º—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    SYNONYMS: Dict[str, str] = {
        '–ø–æ—Å—Ç—É–ø–∏—Ç—å': '–ø–æ—Å—Ç—É–ø–∏—Ç—å –∑–∞—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏–Ω—è—Ç—å',
        '–¥–æ–∫—É–º–µ–Ω—Ç—ã': '–¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–ø—Ä–∞–≤–∫–∏ –±—É–º–∞–≥–∏',
        '—Å—Ä–æ–∫': '—Å—Ä–æ–∫ –¥–∞—Ç–∞ –≤—Ä–µ–º—è –¥–µ–¥–ª–∞–π–Ω',
        '–±—é–¥–∂–µ—Ç': '–±—é–¥–∂–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ö–¶–ü',
        '–ø–ª–∞—Ç–Ω–æ': '–ø–ª–∞—Ç–Ω–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–æ–≥–æ–≤–æ—Ä',
        '–æ–±—â–µ–∂–∏—Ç–∏–µ': '–æ–±—â–µ–∂–∏—Ç–∏–µ –æ–±—â–∞–≥–∞ –∂–∏–ª—å—ë –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ',
        '—Å—Ç–∏–ø–µ–Ω–¥–∏—è': '—Å—Ç–∏–ø–µ–Ω–¥–∏—è –≤—ã–ø–ª–∞—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å',
    }
    
    def process(self, query: str) -> str:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º
        
        Args:
            query: –ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
            
        Returns:
            –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        """
        # 1. –ü—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –¥–ª—è –ø–æ–∏—Å–∫–∞
        query_lower = query.lower()
        
        # 2. –†–∞—Å—à–∏—Ä—è–µ–º —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è
        expanded_query = self._expand_abbreviations(query_lower)
        
        # 3. –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–Ω–æ–Ω–∏–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞)
        # final_query = self._add_synonyms(expanded_query)
        
        return expanded_query
    
    def _expand_abbreviations(self, query: str) -> str:
        """–†–∞—Å—à–∏—Ä—è–µ—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –≤ –∑–∞–ø—Ä–æ—Å–µ"""
        result = query
        
        for abbr, expansion in self.ABBREVIATIONS.items():
            # –ò—â–µ–º —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ
            pattern = r'\b' + re.escape(abbr) + r'\b'
            if re.search(pattern, result, re.IGNORECASE):
                # –ó–∞–º–µ–Ω—è–µ–º –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
                result = re.sub(pattern, expansion, result, flags=re.IGNORECASE)
        
        return result
    
    def _add_synonyms(self, query: str) -> str:
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã –∫ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ, –º–æ–∂–µ—Ç —Ä–∞–∑–¥—É—Ç—å –∑–∞–ø—Ä–æ—Å)"""
        result = query
        
        for word, synonyms in self.SYNONYMS.items():
            pattern = r'\b' + re.escape(word) + r'\b'
            if re.search(pattern, result, re.IGNORECASE):
                # –ù–ï –∑–∞–º–µ–Ω—è–µ–º, –∞ –î–û–ë–ê–í–õ–Ø–ï–ú —Å–∏–Ω–æ–Ω–∏–º—ã
                result += f" {synonyms}"
        
        return result


# === –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï ===
if __name__ == "__main__":
    processor = QueryProcessor()
    
    test_queries = [
        "–ß—Ç–æ —Ç–∞–∫–æ–µ –ë–í–ò?",
        "–ö–∞–∫ –ø–æ—Å—Ç—É–ø–∏—Ç—å –ø–æ –±–≤–∏?",
        "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –ö–¶–ü –Ω—É–∂–Ω—ã?",
        "–°—Ä–æ–∫–∏ –ø–æ–¥–∞—á–∏ –≤ –ú–¢–£–°–ò",
        "–µ–≥—ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"
    ]
    
    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Query Processor:\n")
    
    for query in test_queries:
        processed = processor.process(query)
        print(f"–ò—Å—Ö–æ–¥–Ω—ã–π:     {query}")
        print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π: {processed}")
        print("-" * 60)